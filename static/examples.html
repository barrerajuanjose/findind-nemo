<head>
    <title>Finding Nemo</title>
</head>
<body>
    <label for="sites">Site:</label>
    <select name="site" id="sites">
        <option value="MLB">MLB</option>
        <option value="MLA">MLA</option>
        <option value="MLM">MLM</option>
    </select>

    <br>

    <label for="itemtypes">Items:</label>
    <select name="it" id="itemtypes">
        <option value="">Cualquiera</option>
        <option value="to">Tienda Oficial</option>
        <option value="ds">Mejores vendedores</option>
        <option value="granel">Venta a granel</option>
        <option value="cpg">Supermercado</option>
        <option value="manufacturing">Con tiempo de Manufactura (TODO)</option>
    </select>

    <br>

    <label for="variations">Variations:</label>
    <select name="variations" id="variations">
        <option value="">Cualquiera</option>
        <option value="one">Una</option>
        <option value="two">Dos</option>
        <option value="more">Más de 2</option>
    </select>

    <br>

    <label for="mercadopago">Mercado pago:</label>
    <select name="mp" id="mercadopago">
        <option value="">Cualquiera</option>
        <option value="pjs">Cuotas sin interes</option>
        <option value="installments">Con cuotas con y sin intereses</option>
        <option value="highestprice">Items con precios altos, no se pueden pagar con MP</option>
        <option value="lowestprice">Items con precios bajos</option>
    </select>

    <br>

    <label for="mercadoenvios">Mercado envios:</label>
    <select name="me" id="mercadoenvios">
        <option value="">Cualquiera</option>
        <option value="me2">Con ME</option>
        <option value="full">Full</option>
        <option value="cbt">Envio internacional (Solo MLB y MLM)</option>
    </select>

    <br>

    <input type="button" onclick="getNemos()" value="Find It">

    <div id="nemos">

    </div>

    <script>
        function getNemos() {
            document.getElementById("nemos").innerHTML = "";

            let site = getSelectedValue("sites");
            let it = getSelectedValue("itemtypes");
            let mp = getSelectedValue("mercadopago");
            let me = getSelectedValue("mercadoenvios");
            let variations = getSelectedValue("variations");

            let url = "/search?site=" + site + "&it=" + it + "&mp=" + mp + "&me=" + me + "&variations=" + variations;

            fetch(url)
                .then(function (response) {
                    return response.json();
                })
                .then(function (result) {
                    let html = "<a href='" + result.search_url + "'>Search url</a><br>";
                    html += "Items ids:<br>";
                    result.item_ids.forEach(function(itemId) {
                        html += getItemUrl(itemId);
                    });
                    document.getElementById("nemos").innerHTML = html;
                })
                .catch(function (error) {
                    document.getElementById("nemos").innerHTML = error;
                });
        }

        function getSelectedValue(comboId) {
            let e = document.getElementById(comboId);
            return e.options[e.selectedIndex].value;
        }

        function getItemUrl(itemId) {
            return "<a href='https://api.mercadolibre.com/items/" + itemId + "'>" + itemId + "</a><br>";
        }
    </script>

    <br/>

    <h2>Ejemplos en MLB</h2>
    <a href='http://finding-nemo-jj.herokuapp.com/search?mp=psj&site=MLB'>Sem Juros</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?mp=installments&site=MLB'>Con cuotas</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?mp=highestprice&site=MLB'>Caros (Sin MP)</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?mp=lowestprice&site=MLB'>Baratos</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?me=full&site=MLB'>Full</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?me=me2&site=MLB'>Con shipping</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?it=to&site=MLB'>Tiendas Oficiales</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?it=bs&site=MLB'>Mejores vendedores</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?it=video&site=MLB'>Con videos</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?it=granel&site=MLB'>Venta a granel</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?it=manufacturing&site=MLB'>TODO Tiempo manufactura</a><br/>
    <a href='http://finding-nemo-jj.herokuapp.com/search?me=cpg&site=MLB'>TODO envío internacional</a><br/>
</body>
